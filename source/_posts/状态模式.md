---
title: 设计模式-状态模式
date: 2017-03-01 11:04:42
tags:
---


状态模式，当一个对象的状态改变时，会导致其行为改变，**将每一种条件作为对象内部的一种状态，面对不同的判断结果，它其实就是选择对象内的一种状态**。

举个例子，小时候玩过超级玛丽的游戏，玛丽要吃蘑菇，那么他就要跳起来，玛丽要躲避飞过来的子弹，他就要蹲下，玛丽看到乌龟过来了，要跳起来踩死它，等等...“跳跃，蹲下，加速”等，这些都是玛丽的一个个状态，如果用if或者switch判断，就会写很多，如果增加或者删除一个状态，要改动的地方会很多，并不好维护。

#### if示例：

``` javascript
var lastAction="";
function changeStates(action){
	if(action=='move'){
		//执行move方法
	}else if(action=='jump'){
		//执行jump方法
	}else if(action=='run'){
		//执行run方法
	}
	lastAction=action;
}
```

#### 状态模式示例：

``` javascript
//创建玛丽状态类
var MarryState=function(){
	//当前状态管理
	var _curState={};
	//动作与状态方法映射
	var states={
		move:function(){
			console.log('move')
		},
		run:function(){
			console.log('run')
		},
		jump:function(){
			console.log('jump')
		}
	}
	//动作控制类
	var Action={
		set:function(){
			//获取参数
			var arg=arguments;
			//重置内部状态
			_curState={}
			if(arg.length){
				//遍历动作，如果有动作就添加
				for(var i=0;i<arg.length;i++){
					_curState[arg[i]]=true;
				}
			}
			//返回动作控制类
			return this
		},
		goes:function(){
			//遍历内部状态保存的动作
			for(var attr in _curState){
				//如果当前动作为ture则执行
				_curState[attr]&&states[attr]();
			}
			return this
		}
	}
	
	//返回接口方法
	return {
		set:Action.set,
		goes:Action.goes
	}

}
//实例化玛丽状态对象
var marry=new MarryState();
//设置玛丽跑的动作并执行
marry.set('run').goes(); 
```

### 总结
简而言之状态模式解决了程序中臃肿的分支判断问题，将每个分支转化为一种状态独立出来，方便每种状态的管理又不至于每次执行时遍历所有分支。**当然了状态模式的最终目的即是简化分支判断流程。**
